package com.example.helperapp;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import android.widget.Toast;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import com.google.android.gms.tasks.OnFailureListener;import com.google.android.gms.tasks.OnSuccessListener;import com.google.firebase.auth.AuthResult;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.auth.FirebaseUser;import com.google.firebase.firestore.FirebaseFirestore;import java.util.HashMap;import java.util.Map;public class SignUpActivity extends AppCompatActivity {    private FirebaseAuth mAuth;    private FirebaseFirestore db;    @Override    protected void onStart() {        mAuth = FirebaseAuth.getInstance();        db = FirebaseFirestore.getInstance();        super.onStart();    }    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_sign_up);        EditText nameEt = findViewById(R.id.name_et);        EditText phoneNumberEt = findViewById(R.id.phone_number_et);        EditText emailEt = findViewById(R.id.email_et);        EditText passwordEt = findViewById(R.id.password_et);        EditText confirmPasswordEt = findViewById(R.id.confirm_password_et);        Button submitBtn = findViewById(R.id.submit_btn);        TextView goToLogInPageBtn = findViewById(R.id.go_to_log_in_page_tv);        goToLogInPageBtn.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                startActivity(new Intent(getApplicationContext(), LoginActivity.class));            }        });        submitBtn.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                String name = nameEt.getText().toString();                String phoneNumber = phoneNumberEt.getText().toString();                String email = emailEt.getText().toString();                String password = passwordEt.getText().toString();                String confirmPassword = confirmPasswordEt.getText().toString();                if (!password.equals(confirmPassword)) {                    Toast.makeText(SignUpActivity.this, "Check your passwords!", Toast.LENGTH_SHORT).show();                    return;                }                if (name.isEmpty() || phoneNumber.isEmpty() || email.isEmpty() || password.isEmpty()) {                    Toast.makeText(SignUpActivity.this, "Invalid Values!", Toast.LENGTH_SHORT).show();                    return;                }                new Thread(new SignUpTask(name, phoneNumber, email, password)).start();            }        });    }    private class SignUpTask implements Runnable {        private final String name;        private final String phoneNumber;        private final String email;        private final String password;        public SignUpTask(String name, String phoneNumber, String email, String password) {            this.name = name;            this.phoneNumber = phoneNumber;            this.email = email;            this.password = password;        }        @Override        public void run() {            mAuth.createUserWithEmailAndPassword(email, password)                    .addOnSuccessListener(new OnSuccessListener<AuthResult>() {                        @Override                        public void onSuccess(AuthResult authResult) {                            FirebaseUser newUser = mAuth.getCurrentUser();                            if(newUser != null) {                                String userId = newUser.getUid();                                Map<String, Object> user = new HashMap<>();                                user.put("name", name);                                user.put("phoneNumber", phoneNumber);                                db.collection("/user-profile").document(userId).set(user)                                        .addOnSuccessListener(aVoid -> {                                            runOnUiThread(() -> {                                                Toast.makeText(SignUpActivity.this, "Account creation successful, Login to continue!", Toast.LENGTH_SHORT).show();                                                startActivity(new Intent(getApplicationContext(), LoginActivity.class));                                                finish();                                            });                                        })                                        .addOnFailureListener(e -> runOnUiThread( () -> {                                            mAuth.getCurrentUser().delete().addOnSuccessListener(aVoid -> {}).addOnFailureListener(anotherException -> {                                                Toast.makeText(SignUpActivity.this, anotherException.getMessage(), Toast.LENGTH_SHORT).show();                                            });                                            Toast.makeText(SignUpActivity.this, e.getMessage(), Toast.LENGTH_SHORT).show();                                        }));                            }                        }                    })                    .addOnFailureListener(new OnFailureListener() {                        @Override                        public void onFailure(@NonNull Exception e) {                            Toast.makeText(SignUpActivity.this, e.getMessage(), Toast.LENGTH_SHORT).show();                        }                    });        }    }}